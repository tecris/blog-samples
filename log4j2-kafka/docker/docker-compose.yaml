version: '3'
services:

  zookeeper:
    image: zookeeper
    container_name: zookeeper

  kafka:
    image: trivialis/kafka:1.1.0
    container_name: kafka
    ports:
      - "9092:9092"
    entrypoint:
      - /usr/local/kafka/bin/kafka-server-start.sh
      - /usr/local/kafka/config/server.properties
      - --override
      - zookeeper.connect=zookeeper:2181
      - --override
      - listeners=PLAINTEXT://kafka:$KAFKA_PORT
      - --override
      - advertised.listeners=PLAINTEXT://$KAFKA_HOST:$KAFKA_PORT
    depends_on:
      - zookeeper

  kafka.tls:
    image: trivialis/kafka.tls:1.1.0
    container_name: kafka.tls
    ports:
      - "$KAFKA_PORT:9092"
    entrypoint:
      - /usr/local/kafka/bin/kafka-server-start.sh
      - /usr/local/kafka/config/server.properties
      - --override
      - zookeeper.connect=zookeeper:2181
      - --override
      - security.inter.broker.protocol=SSL
      - --override
      - listeners=SSL://kafka.tls:9092
      - --override
      - advertised.listeners=SSL://$KAFKA_HOST:$KAFKA_PORT
      - --override
      - ssl.keystore.location=/etc/security/tls/server.keystore.jks
      - --override
      - ssl.keystore.password=salzburg
      - --override
      - ssl.key.password=salzburg
      - --override
      - ssl.truststore.location=/etc/security/tls/server.truststore.jks
      - --override
      - ssl.truststore.password=salzburg
      - --override
      - ssl.client.auth=required
    depends_on:
      - zookeeper
